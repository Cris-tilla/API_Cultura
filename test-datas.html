<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Extra√ß√£o de Datas</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-case { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .input { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 3px; }
        .result { background: #e8f5e8; padding: 10px; margin: 10px 0; border-radius: 3px; }
        .error { background: #ffe8e8; padding: 10px; margin: 10px 0; border-radius: 3px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üß™ Teste de Extra√ß√£o de Datas</h1>
    <p>Este arquivo testa a fun√ß√£o de extra√ß√£o de datas do sistema de busca.</p>
    
    <button onclick="testarExtracaoDatas()">üîç Testar Extra√ß√£o de Datas</button>
    
    <div id="results"></div>

    <script>
        // Fun√ß√£o para extrair data do texto - SUPER ROBUSTA
        function extrairData(texto) {
            if (!texto || typeof texto !== 'string') return null;
            
            // Log para debug
            console.log(`üîç Tentando extrair data de: "${texto.substring(0, 100)}..."`);
            
                    // M√∫ltiplos padr√µes de data - SUPER AGRESSIVOS
        const datePatterns = [
            // dd/mm/yyyy ou dd-mm-yyyy
            /(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,
            // dd/mm/yy ou dd-mm-yy
            /(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2})/,
            // yyyy-mm-dd
            /(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2})/,
            // dd.mm.yyyy
            /(\d{1,2})\.(\d{1,2})\.(\d{4})/,
            // dd.mm.yy
            /(\d{1,2})\.(\d{1,2})\.(\d{2})/,
            // yyyy.mm.dd
            /(\d{4})\.(\d{1,2})\.(\d{1,2})/,
            // dd de m√™s de yyyy (portugu√™s)
            /(\d{1,2})\s+de\s+(janeiro|fevereiro|mar√ßo|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)\s+de\s+(\d{4})/i,
            // m√™s de yyyy
            /(janeiro|fevereiro|mar√ßo|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)\s+de\s+(\d{4})/i,
            // apenas ano (quando isolado)
            /\b(19[0-9]{2}|20[0-9]{2})\b/,
            // Padr√µes adicionais comuns
            /(\d{1,2})\s+(janeiro|fevereiro|mar√ßo|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)\s+(\d{4})/i,
            /(janeiro|fevereiro|mar√ßo|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)\s+(\d{4})/i,
            // Padr√µes mais flex√≠veis
            /(\d{1,2})\s*[\/\-\.]\s*(\d{1,2})\s*[\/\-\.]\s*(\d{2,4})/,
            // Anos com contexto
            /(ano|em|de)\s+(\d{4})/i,
            /(\d{4})\s+(ano|anos)/i,
            // Datas em contexto de edital
            /(edital|licita√ß√£o|licitacao|sele√ß√£o|selecao|concurso|chamada)\s+(de|em|para)\s+(\d{1,2})[\/\-\.](\d{1,2})[\/\-\.](\d{4})/i,
            // Datas em contexto de evento
            /(evento|festival|mostra|exposi√ß√£o|exposicao|workshop|oficina)\s+(de|em|para)\s+(\d{1,2})[\/\-\.](\d{1,2})[\/\-\.](\d{4})/i
        ];
            
            for (let i = 0; i < datePatterns.length; i++) {
                const pattern = datePatterns[i];
                const match = texto.match(pattern);
                if (match) {
                    console.log(`‚úÖ Padr√£o ${i + 1} encontrado:`, match[0]);
                    
                    // Para padr√µes com m√™s por extenso, converter para formato padr√£o
                    if (pattern.source.includes('janeiro|fevereiro')) {
                        if (match.length === 4) {
                            // dd de m√™s de yyyy
                            const mes = getMonthNumber(match[2]);
                            const result = `${match[1]}/${mes}/${match[3]}`;
                            console.log(`üìÖ Data convertida: ${match[0]} ‚Üí ${result}`);
                            return result;
                        } else if (match.length === 3) {
                            // m√™s de yyyy
                            const mes = getMonthNumber(match[1]);
                            const result = `01/${mes}/${match[2]}`;
                            console.log(`üìÖ Data convertida: ${match[0]} ‚Üí ${result}`);
                            return result;
                        }
                    } else if (pattern.source.includes('19[0-9]{2}|20[0-9]{2}')) {
                        // Apenas ano encontrado
                        const result = `01/01/${match[1]}`;
                        console.log(`üìÖ Ano convertido: ${match[1]} ‚Üí ${result}`);
                        return result;
                    } else if (pattern.source.includes('ano|em|de')) {
                        // Ano com contexto
                        const result = `01/01/${match[2]}`;
                        console.log(`üìÖ Ano com contexto convertido: ${match[0]} ‚Üí ${result}`);
                        return result;
                    } else if (pattern.source.includes('edital|licita√ß√£o|licitacao|sele√ß√£o|selecao|concurso|chamada')) {
                        // Data em contexto de edital
                        const result = `${match[3]}/${match[4]}/${match[5]}`;
                        console.log(`üìÖ Data de edital convertida: ${match[0]} ‚Üí ${result}`);
                        return result;
                    } else if (pattern.source.includes('evento|festival|mostra|exposi√ß√£o|exposicao|workshop|oficina')) {
                        // Data em contexto de evento
                        const result = `${match[3]}/${match[4]}/${match[5]}`;
                        console.log(`üìÖ Data de evento convertida: ${match[0]} ‚Üí ${result}`);
                        return result;
                    } else {
                        // Padr√µes num√©ricos padr√£o
                        console.log(`üìÖ Data encontrada: ${match[0]}`);
                        return match[0];
                    }
                }
            }
            
            console.log(`‚ùå Nenhum padr√£o de data encontrado`);
            return null;
        }

        // Fun√ß√£o auxiliar para converter nome do m√™s para n√∫mero
        function getMonthNumber(monthName) {
            const months = {
                'janeiro': '01', 'fevereiro': '02', 'mar√ßo': '03', 'abril': '04',
                'maio': '05', 'junho': '06', 'julho': '07', 'agosto': '08',
                'setembro': '09', 'outubro': '10', 'novembro': '11', 'dezembro': '12'
            };
            return months[monthName.toLowerCase()] || '01';
        }

        // Casos de teste
        const testCases = [
            "Edital de Teatro Municipal de 15/03/2000",
            "Festival de Arte Visual em 20-12-2005",
            "Workshop de Escultura em 2008",
            "Exposi√ß√£o de Arte Contempor√¢nea em janeiro de 2010",
            "Pr√™mio de Cultura em 15 de mar√ßo de 2012",
            "Mostra de Arte em abril de 2015",
            "Edital de Resid√™ncia Art√≠stica em 2020",
            "Concurso de Fotografia em 2023",
            "Semin√°rio de Arte Digital em 30.11.2018",
            "Encontro de Artistas em 25-06-2019",
            "Festival de Cinema em 2017",
            "Exposi√ß√£o de Esculturas em 10 de dezembro de 2016",
            "Workshop de Pintura em mar√ßo de 2014",
            "Edital de Bolsa em 2003",
            "Mostra de Arte Moderna em 2007",
            // Novos casos de teste
            "Edital de sele√ß√£o para o ano 2005",
            "Festival em 2010 anos de hist√≥ria",
            "Concurso de edital para 15/12/2002",
            "Workshop de evento para 20.03.2009",
            "Exposi√ß√£o de mostra para 10-06-2011",
            "Oficina de festival para 25.09.2013",
            "Chamada de licita√ß√£o para 05/11/2006",
            "Preg√£o de concurr√™ncia para 18.04.2004",
            "Credenciamento de edital para 30-08-2016",
            "Certame de processo para 12.07.2001"
        ];

        function testarExtracaoDatas() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h2>üìä Resultados dos Testes</h2>';
            
            let successCount = 0;
            let totalCount = testCases.length;
            
            testCases.forEach((testCase, index) => {
                const result = extrairData(testCase);
                const testDiv = document.createElement('div');
                testDiv.className = 'test-case';
                
                if (result) {
                    testDiv.innerHTML = `
                        <h3>‚úÖ Teste ${index + 1} - SUCESSO</h3>
                        <div class="input"><strong>Entrada:</strong> ${testCase}</div>
                        <div class="result"><strong>Data extra√≠da:</strong> ${result}</div>
                    `;
                    successCount++;
                } else {
                    testDiv.innerHTML = `
                        <h3>‚ùå Teste ${index + 1} - FALHOU</h3>
                        <div class="input"><strong>Entrada:</strong> ${testCase}</div>
                        <div class="error"><strong>Erro:</strong> Nenhuma data encontrada</div>
                    `;
                }
                
                resultsDiv.appendChild(testDiv);
            });
            
            // Resumo final
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'test-case';
            summaryDiv.style.backgroundColor = successCount === totalCount ? '#e8f5e8' : '#fff3cd';
            summaryDiv.innerHTML = `
                <h3>üìà Resumo dos Testes</h3>
                <p><strong>Total de testes:</strong> ${totalCount}</p>
                <p><strong>Sucessos:</strong> ${successCount}</p>
                <p><strong>Falhas:</strong> ${totalCount - successCount}</p>
                <p><strong>Taxa de sucesso:</strong> ${((successCount / totalCount) * 100).toFixed(1)}%</p>
            `;
            
            resultsDiv.appendChild(summaryDiv);
            
            console.log(`üß™ Testes conclu√≠dos: ${successCount}/${totalCount} sucessos`);
        }
    </script>
</body>
</html>
